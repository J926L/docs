version: '3'

dotenv: ['.env']

tasks:
  sync:
    desc: Interpolate env vars into template and sync to Gemini CLI / Claude
    cmds:
      # 1. ç”Ÿæˆæ¨¡æ¿ (YAML -> JSON)
      - envsubst < mcp_config.yaml | yq . > mcp_config.json
      - echo "âœ… mcp_config.json generated"
      
      # 2. åŒæ­¥è‡³ Gemini CLI (ä¼˜å…ˆ)
      - |
        SETTINGS_FILE="$HOME/.gemini/settings.json"
        if [ -f "$SETTINGS_FILE" ]; then
          # ä½¿ç”¨ jq æ·±åº¦åˆå¹¶ mcpServers å­—æ®µåˆ° settings.json
          jq -s '.[0] * .[1]' "$SETTINGS_FILE" mcp_config.json > "${SETTINGS_FILE}.tmp" && mv "${SETTINGS_FILE}.tmp" "$SETTINGS_FILE"
          echo "ğŸš€ Synced to Gemini CLI (~/.gemini/settings.json)"
        else
          echo "âš ï¸ Gemini CLI settings.json not found, skipping sync."
        fi

      # 3. åŒæ­¥è‡³ Claude Desktop (å¯é€‰)
      - |
        if [ -d "$HOME/.config/Claude" ]; then
          cp mcp_config.json "$HOME/.config/Claude/config.json"
          echo "ğŸš€ Synced to Claude Desktop"
        fi

  chat:
    desc: Start Gemini CLI chat with MCP enabled
    cmds:
      - gemini

